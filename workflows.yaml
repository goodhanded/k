workflows:

  code_advice:
    nodes:
      - get_project_path
      - load_include_exclude_rules
      - load_file_collection
      - load_directory_tree
      - load_source_code
      - generate_code_advice

    edges:
      - from: START
        to: get_project_path

      - from: get_project_path
        to: load_include_exclude_rules

      - from: load_include_exclude_rules
        to: load_file_collection

      - from: load_file_collection
        to: load_directory_tree
      - from: load_file_collection
        to: load_source_code

        # converge
      - from: load_directory_tree
        to: generate_code_advice
      - from: load_source_code
        to: generate_code_advice

        # get code advice
      - from: generate_code_advice
        to: END

  pull_request:
    nodes:
      - get_project_path
      - load_include_exclude_rules
      - load_project_rules
      - load_file_collection
      - load_directory_tree
      - load_source_code
      - generate_changeset
      - implement_changeset
    edges:
      - from: START
        to: get_project_path

        # two branches
      - from: get_project_path
        to: load_include_exclude_rules
      - from: get_project_path
        to: load_project_rules

        # converge
      - from: load_project_rules
        to: load_file_collection
      - from: load_include_exclude_rules
        to: load_file_collection

        # two branches
      - from: load_file_collection
        to: load_directory_tree
      - from: load_file_collection
        to: load_source_code

        # converge
      - from: load_directory_tree
        to: generate_changeset
      - from: load_source_code
        to: generate_changeset

        # implement
      - from: generate_changeset
        to: implement_changeset

      - from: implement_changeset
        to: END

      # - from: run_tests
      #   to: generate_changeset
      #   condition: "not state.tests_passed"

      # - from: run_tests
      #   to: END
      #   condition: "state.tests_passed"

  run_tests:
    nodes:
      - run_tests
    edges:
      - from: START
        to: run_tests

      - from: run_tests
        to: END